{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
   crossorigin=""></script>
  <script>
  $(document).ready(function() {
    var map = L.map('map').setView([50.616667,  3.016667], 8);
    // add tile to map
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    // load points from json file
    $.getJSON("/things_wgs84.json", function( js_data ) {
      for (var i in js_data) {
          // format a popup
          mkr_popup  = '<table>';
          mkr_popup += '<tr><td align="center"><b>' + js_data[i].name + '</b></td></tr>';
          mkr_popup += '<tr><td align="center">';
          mkr_popup += '<a href="/devices/id/' + js_data[i].device_id +'">' +js_data[i].device_id +'</a>';
          mkr_popup += '</td></tr>';
          mkr_popup += '</table>'
          // add a marker with a popup
          L.marker([js_data[i].lat, js_data[i].lng]).addTo(map).bindPopup(mkr_popup);
      }
    });
  });
  </script>
{% endblock %}

{% block content %}
  <div id="map" style="height:600px"></div>
{% endblock %}
